<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Our memories together." />
  <title>Our Memories ðŸ’ž</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="css/modern.css" />
  <script src="js/site-config.js"></script>
</head>
<body class="unlocked">
  <header class="site-header">
    <nav class="nav container">
      <a href="index.html#home" class="logo" aria-label="Go to Home" id="siteLogo">For Mahak</a>
      <ul class="nav-menu">
        <li><a href="index.html#story">Our Story</a></li>
        <li><a href="memories.html" aria-current="page">Our Memories</a></li>
        <li><a href="photobooth.html">Steal a smile ðŸ“¸</a></li>
        <li><a href="index.html#letters">Love Letters</a></li>
        <li><a href="index.html#playlist">Playlist</a></li>
      </ul>
    </nav>
  </header>

  <main class="section">
    <div class="container">
      <h1 style="font-family:'Playfair Display',serif;">Our Memories</h1>
      <p class="subtitle">A little gallery of the moments that feel like home.</p>
      <div id="memoriesFolders" class="polaroid-wall"></div>
    </div>
  </main>

  <!-- Lightbox for gallery -->
  <div id="lightbox" class="lightbox">
    <button id="lightbox-close" class="lightbox-close">&times;</button>
    <button id="lightbox-prev" class="lightbox-nav lightbox-prev">&#8249;</button>
    <img id="lightbox-img" class="lightbox-img" alt="Gallery Image" />
    <button id="lightbox-next" class="lightbox-nav lightbox-next">&#8250;</button>
    <div id="lightbox-caption" class="lightbox-caption"></div>
  </div>

  <script>
    // Secret logo tap for easter egg
    const logos = document.querySelectorAll('.logo');
    let taps = 0;
    let tapTimer = null;
    logos.forEach((logo) => {
      logo.addEventListener('click', function (event) {
        taps += 1;
        clearTimeout(tapTimer);
        tapTimer = setTimeout(() => { taps = 0; }, 2400);
        if (taps >= 5) {
          taps = 0;
          window.location.href = 'secret.html';
        }
      });
    });

    // Mixed gallery with all photos (your original logic preserved)
    (function(){
      const galleryMap = window.SITE_CONFIG.gallery || {};
      const memoriesFolders = document.getElementById('memoriesFolders');
      const lightbox = document.getElementById('lightbox');
      const lightboxImg = document.getElementById('lightbox-img');
      const lightboxCaption = document.getElementById('lightbox-caption');
      const lightboxClose = document.getElementById('lightbox-close');
      const lightboxPrev = document.getElementById('lightbox-prev');
      const lightboxNext = document.getElementById('lightbox-next');
      let currentIndex = 0;
      let currentList = [];

      // Collect all images from all folders and shuffle them
      const allImages = [];
      Object.keys(galleryMap).forEach(folder => {
        galleryMap[folder].forEach(name => {
          allImages.push({
            src: `assets/images/${folder}/${name}`,
            alt: name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'').replace('Copy','').trim()
          });
        });
      });
      
      // Shuffle the array randomly
      for (let i = allImages.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [allImages[i], allImages[j]] = [allImages[j], allImages[i]];
      }

      currentList = allImages;
      
      allImages.forEach((image, idx) => {
        const figure = document.createElement('figure');
        figure.className = 'polaroid-item';
        const tilt = (Math.random() * 8 - 4).toFixed(2);
        figure.style.setProperty('--tilt', `${tilt}deg`);
        
        const img = document.createElement('img');
        img.src = image.src;
        img.alt = image.alt;
        img.onerror = function() { figure.style.display = 'none'; };
        img.addEventListener('click', () => openLightbox(idx));
        
        const cap = document.createElement('figcaption');
        cap.textContent = image.alt;
        
        figure.appendChild(img);
        figure.appendChild(cap);
        memoriesFolders.appendChild(figure);
      });

      // Lightbox logic
      function openLightbox(idx){
        currentIndex = idx;
        showLightbox();
        lightbox.style.display = 'flex';
      }
      function showLightbox(){
        const file = currentList[currentIndex];
        if(file) {
          lightboxImg.src = file.src;
          lightboxCaption.textContent = file.alt;
        }
      }
      function closeLightbox(){ lightbox.style.display = 'none'; }
      function prev(){ currentIndex = (currentIndex - 1 + currentList.length) % currentList.length; showLightbox(); }
      function next(){ currentIndex = (currentIndex + 1) % currentList.length; showLightbox(); }
      lightboxClose.onclick = closeLightbox;
      lightboxPrev.onclick = prev;
      lightboxNext.onclick = next;
      lightbox.addEventListener('click', e => { if(e.target === lightbox) closeLightbox(); });
    })();
  </script>
</body>
</html>
